local repo = "https://raw.githubusercontent.com/deividcomsono/Obsidian/main/"
local Library = loadstring(game:HttpGet(repo .. "Library.lua"))()
local ThemeManager = loadstring(game:HttpGet(repo .. "addons/ThemeManager.lua"))()
local SaveManager = loadstring(game:HttpGet(repo .. "addons/SaveManager.lua"))()

-- Load the module from GitHub
local Module = loadstring(game:HttpGet("https://raw.githubusercontent.com/checkurasshole/Trt/refs/heads/main/yes"))()

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

local Options = Library.Options
local Toggles = Library.Toggles

local Window = Library:CreateWindow({
    Title = "COMBO_WICK",
    Footer = "Version 2.0",
    NotifySide = "Right",
    ShowCustomCursor = true,
    Size = UDim2.fromOffset(580, 460),
})

local Tabs = {
    Respawn = Window:AddTab("Auto Respawn", "refresh-cw"),
    AimAssist = Window:AddTab("Aim Assistant", "target"),
    Hitbox = Window:AddTab("Hitbox", "maximize"),
    Visuals = Window:AddTab("Visuals", "eye"),
    ["UI Settings"] = Window:AddTab("UI Settings", "settings"),
}

local AutoPlayBox = Tabs.Respawn:AddLeftGroupbox("Auto Play Loop")
local AimbotV1Box = Tabs.AimAssist:AddLeftGroupbox("Version 1 - Manual PC")
local AimbotV2Box = Tabs.AimAssist:AddRightGroupbox("Version 2 - Automatic")
local HitboxBox = Tabs.Hitbox:AddLeftGroupbox("Expand Hitbox")
local TriggerBox = Tabs.Hitbox:AddRightGroupbox("Auto Shoot")
local ESPBox = Tabs.Visuals:AddLeftGroupbox("Player ESP")
local TracerBox = Tabs.Visuals:AddRightGroupbox("Tracers")

Module.Initialize(Library, Options, Toggles)

-- AUTO RESPAWN
AutoPlayBox:AddToggle("AutoPlay", {
    Text = "Auto Play Loop",
    Default = false,
    Tooltip = "Auto respawn on death",
})

Toggles.AutoPlay:OnChanged(function()
    Module.autoPlayEnabled = Toggles.AutoPlay.Value
end)

-- AIMBOT V1
AimbotV1Box:AddToggle("AimbotV1", {
    Text = "Enable",
    Default = false,
    Tooltip = "Hold right click to lock",
})

Toggles.AimbotV1:OnChanged(function()
    Module.aimbotV1Enabled = Toggles.AimbotV1.Value
    if Module.aimbotV1Enabled then
        if Module.aimbotV1Connection then Module.aimbotV1Connection:Disconnect() end
        
        Module.aimbotV1Connection = RunService.RenderStepped:Connect(function()
            if not Module.aimbotV1Enabled then return end
            
            if UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
                Module.currentTargetV1 = Module.getClosestPlayerV1()
                if Module.currentTargetV1 then
                    Module.aimAtV1(Module.currentTargetV1)
                end
            else
                Module.currentTargetV1 = nil
            end
        end)
    else
        if Module.aimbotV1Connection then
            Module.aimbotV1Connection:Disconnect()
            Module.aimbotV1Connection = nil
        end
        Module.currentTargetV1 = nil
    end
end)

AimbotV1Box:AddSlider("AimbotV1FOV", {
    Text = "FOV Radius",
    Default = 200,
    Min = 50,
    Max = 500,
    Rounding = 0,
})

Options.AimbotV1FOV:OnChanged(function()
    Module.fovRadiusV1 = Options.AimbotV1FOV.Value
end)

AimbotV1Box:AddSlider("AimbotV1Smoothing", {
    Text = "Smoothing",
    Default = 5,
    Min = 1,
    Max = 20,
    Rounding = 1,
})

Options.AimbotV1Smoothing:OnChanged(function()
    Module.smoothingFactorV1 = Options.AimbotV1Smoothing.Value
end)

AimbotV1Box:AddDropdown("AimbotV1Part", {
    Values = {"Head", "Torso", "HumanoidRootPart"},
    Default = 1,
    Text = "Target Part",
})

Options.AimbotV1Part:OnChanged(function()
    Module.aimPartV1 = Options.AimbotV1Part.Value
end)

AimbotV1Box:AddToggle("WallCheckV1", {
    Text = "Wall Check",
    Default = true,
})

Toggles.WallCheckV1:OnChanged(function()
    Module.wallCheckV1 = Toggles.WallCheckV1.Value
end)

AimbotV1Box:AddToggle("ShowFOVV1", {
    Text = "Show FOV Circle",
    Default = false,
})

Toggles.ShowFOVV1:OnChanged(function()
    if Toggles.ShowFOVV1.Value then
        if not Module.fovCircleV1 then
            Module.fovCircleV1 = Drawing.new("Circle")
            Module.fovCircleV1.Thickness = 2
            Module.fovCircleV1.NumSides = 64
            Module.fovCircleV1.Filled = false
            Module.fovCircleV1.Transparency = 1
            Module.fovCircleV1.Color = Color3.fromRGB(0, 255, 255)
        end
        Module.fovCircleV1.Visible = true
        
        Module.connections.FOVV1Circle = RunService.RenderStepped:Connect(function()
            if Toggles.ShowFOVV1.Value and Module.fovCircleV1 then
                Module.fovCircleV1.Radius = Module.fovRadiusV1
                Module.fovCircleV1.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
            end
        end)
    else
        if Module.fovCircleV1 then
            Module.fovCircleV1.Visible = false
        end
        if Module.connections.FOVV1Circle then
            Module.connections.FOVV1Circle:Disconnect()
        end
    end
end)

-- AIMBOT V2
AimbotV2Box:AddToggle("AimbotV2", {
    Text = "Enable",
    Default = false,
    Tooltip = "Auto lock no button",
})

Toggles.AimbotV2:OnChanged(function()
    Module.aimbotV2Enabled = Toggles.AimbotV2.Value
end)

AimbotV2Box:AddSlider("AimbotV2Smooth", {
    Text = "Smoothing",
    Default = 5,
    Min = 1,
    Max = 20,
    Rounding = 1,
})

Options.AimbotV2Smooth:OnChanged(function()
    Module.smoothingFactorV2 = Options.AimbotV2Smooth.Value
end)

AimbotV2Box:AddSlider("AimbotV2FOV", {
    Text = "FOV Radius",
    Default = 100,
    Min = 50,
    Max = 300,
    Rounding = 0,
})

Options.AimbotV2FOV:OnChanged(function()
    Module.fovRadiusV2 = Options.AimbotV2FOV.Value
end)

AimbotV2Box:AddDropdown("AimbotV2Part", {
    Text = "Target Part",
    Values = {"Head", "Torso", "HumanoidRootPart"},
    Default = 1,
})

Options.AimbotV2Part:OnChanged(function()
    Module.aimPartV2 = Options.AimbotV2Part.Value
end)

AimbotV2Box:AddToggle("WallCheckV2", {
    Text = "Wall Check",
    Default = false,
})

Toggles.WallCheckV2:OnChanged(function()
    Module.wallCheckV2 = Toggles.WallCheckV2.Value
end)

AimbotV2Box:AddToggle("ShowFOVV2", {
    Text = "Show FOV Circle",
    Default = false,
})

Toggles.ShowFOVV2:OnChanged(function()
    if Toggles.ShowFOVV2.Value then
        Module.fovCircleV2 = Drawing.new("Circle")
        Module.fovCircleV2.Visible = true
        Module.fovCircleV2.Thickness = 2
        Module.fovCircleV2.NumSides = 64
        Module.fovCircleV2.Filled = false
        Module.fovCircleV2.Transparency = 1
        Module.fovCircleV2.Color = Color3.fromRGB(255, 255, 255)
        
        Module.connections.FOVV2Circle = RunService.RenderStepped:Connect(function()
            if Module.fovCircleV2 then
                Module.fovCircleV2.Radius = Module.fovRadiusV2
                Module.fovCircleV2.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
            end
        end)
        
        Module.connections.FOVV2CircleCleanup = Module.fovCircleV2
    else
        if Module.connections.FOVV2Circle then
            Module.connections.FOVV2Circle:Disconnect()
        end
        if Module.connections.FOVV2CircleCleanup then
            Module.connections.FOVV2CircleCleanup:Remove()
            Module.connections.FOVV2CircleCleanup = nil
        end
    end
end)

-- HITBOX
HitboxBox:AddToggle("Hitbox", {
    Text = "Enable",
    Default = false,
})

Toggles.Hitbox:OnChanged(function()
    if Toggles.Hitbox.Value then
        Module.connections.Hitbox = RunService.Heartbeat:Connect(function()
            for _, player in pairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and Module.isAlive(player) then
                    Module.adjustHitbox(player.Character)
                end
            end
        end)
    else
        if Module.connections.Hitbox then
            Module.connections.Hitbox:Disconnect()
        end
        for _, player in pairs(Players:GetPlayers()) do
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local rootPart = player.Character.HumanoidRootPart
                rootPart.Size = Vector3.new(2, 2, 1)
                rootPart.Transparency = 0
                rootPart.CanCollide = true
            end
        end
    end
end)

HitboxBox:AddSlider("HitboxSize", {
    Text = "Size",
    Default = 9,
    Min = 2,
    Max = 20,
    Rounding = 1,
})

HitboxBox:AddSlider("HitboxTransparency", {
    Text = "Transparency",
    Default = 0.5,
    Min = 0,
    Max = 1,
    Rounding = 2,
})

-- TRIGGER BOT
TriggerBox:AddToggle("TriggerBot", {
    Text = "Enable",
    Default = false,
    Tooltip = "Auto shoot on lock",
})

TriggerBox:AddSlider("TriggerDelay", {
    Text = "Delay (ms)",
    Default = 50,
    Min = 0,
    Max = 500,
    Rounding = 0,
})

Toggles.TriggerBot:OnChanged(function()
    if Toggles.TriggerBot.Value then
        if Module.triggerConnection then Module.triggerConnection:Disconnect() end
        
        Module.triggerConnection = RunService.Heartbeat:Connect(function()
            if not Toggles.TriggerBot.Value then return end
            
            if Module.aimbotV1Enabled and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
                if Module.currentTargetV1 and Module.isAlive(Module.currentTargetV1) then
                    if Module.wallCheckV1 then
                        if not Module.canSeeTarget(Module.currentTargetV1.Character, Module.aimPartV1) then
                            return
                        end
                    end
                    
                    task.wait(Options.TriggerDelay.Value / 1000)
                    mouse1click()
                end
            elseif Module.aimbotV2Enabled then
                if Module.currentTargetV2 then
                    local targetParent = Module.currentTargetV2.Parent
                    if targetParent and targetParent:IsA("Model") then
                        local player = Players:GetPlayerFromCharacter(targetParent)
                        if player and Module.isAlive(player) then
                            if Module.wallCheckV2 then
                                if not Module.canSeeTarget(player.Character, Module.aimPartV2) then
                                    return
                                end
                            end
                            
                            task.wait(Options.TriggerDelay.Value / 1000)
                            mouse1click()
                        end
                    end
                end
            end
        end)
    else
        if Module.triggerConnection then
            Module.triggerConnection:Disconnect()
            Module.triggerConnection = nil
        end
    end
end)

-- ESP
ESPBox:AddToggle("BoxESP", {
    Text = "Box ESP",
    Default = false,
})

Toggles.BoxESP:OnChanged(function()
    if Toggles.BoxESP.Value then
        if not Module.connections.ESPUpdate then
            Module.connections.ESPUpdate = task.spawn(Module.espUpdateLoop)
        end
        task.wait(0.1)
        Module.initializeAllESP()
    else
        for player, _ in pairs(Module.espObjects) do
            if Module.espObjects[player] and Module.espObjects[player].highlight then
                Module.espObjects[player].highlight:Destroy()
                Module.espObjects[player].highlight = nil
            end
        end
    end
end)

ESPBox:AddToggle("NameESP", {
    Text = "Name Distance",
    Default = false,
})

Toggles.NameESP:OnChanged(function()
    if Toggles.NameESP.Value then
        if not Module.connections.ESPUpdate then
            Module.connections.ESPUpdate = task.spawn(Module.espUpdateLoop)
        end
        task.wait(0.1)
        Module.initializeAllESP()
    else
        for player, _ in pairs(Module.espObjects) do
            if Module.espObjects[player] and Module.espObjects[player].billboard then
                Module.espObjects[player].billboard:Destroy()
                Module.espObjects[player].billboard = nil
                Module.espObjects[player].nameLabel = nil
                Module.espObjects[player].distLabel = nil
            end
        end
    end
end)

ESPBox:AddToggle("HealthBar", {
    Text = "Health Bar",
    Default = false,
})

Toggles.HealthBar:OnChanged(function()
    if Toggles.HealthBar.Value then
        if not Module.connections.ESPUpdate then
            Module.connections.ESPUpdate = task.spawn(Module.espUpdateLoop)
        end
        task.wait(0.1)
        Module.initializeAllESP()
    else
        for player, _ in pairs(Module.espObjects) do
            if Module.espObjects[player] and Module.espObjects[player].healthBG then
                Module.espObjects[player].healthBG:Destroy()
                Module.espObjects[player].healthBG = nil
                Module.espObjects[player].healthBar = nil
            end
        end
    end
end)

ESPBox:AddToggle("RainbowESP", {
    Text = "Rainbow Mode",
    Default = false,
})

-- TRACERS
TracerBox:AddToggle("Tracers", {
    Text = "Enable",
    Default = false,
})

Toggles.Tracers:OnChanged(function()
    if Toggles.Tracers.Value then
        Module.tracerConnection = RunService.RenderStepped:Connect(function()
            for player, line in pairs(Module.tracerObjects) do
                if line then line:Remove() end
                Module.tracerObjects[player] = nil
            end
            
            local useRainbow = Toggles.RainbowTracers and Toggles.RainbowTracers.Value
            
            for _, player in pairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and Module.isAlive(player) then
                    local char = player.Character
                    local hrp = char:FindFirstChild("HumanoidRootPart")
                    if hrp then
                        local screenPos, onScreen = Module.worldToScreen(hrp.Position)
                        if onScreen then
                            if not Module.tracerObjects[player] then
                                Module.tracerObjects[player] = Drawing.new("Line")
                            end
                            
                            local line = Module.tracerObjects[player]
                            line.Visible = true
                            line.Color = useRainbow and Module.getRainbowColor() or Color3.fromRGB(255, 85, 85)
                            line.Thickness = Options.TracerThickness.Value
                            line.Transparency = 1
                            
                            local fromPos
                            if Options.TracerPosition.Value == "Top" then
                                fromPos = Vector2.new(Camera.ViewportSize.X / 2, 0)
                            elseif Options.TracerPosition.Value == "Middle" then
                                fromPos = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
                            else
                                fromPos = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
                            end
                            
                            line.From = fromPos
                            line.To = screenPos
                        end
                    end
                end
            end
        end)
    else
        if Module.tracerConnection then
            Module.tracerConnection:Disconnect()
            Module.tracerConnection = nil
        end
        for player, line in pairs(Module.tracerObjects) do
            if line then line:Remove() end
            Module.tracerObjects[player] = nil
        end
    end
end)

TracerBox:AddDropdown("TracerPosition", {
    Text = "Start Position",
    Values = {"Top", "Middle", "Bottom"},
    Default = 3,
})

TracerBox:AddSlider("TracerThickness", {
    Text = "Thickness",
    Default = 1,
    Min = 1,
    Max = 5,
    Rounding = 0,
})

TracerBox:AddToggle("RainbowTracers", {
    Text = "Rainbow Mode",
    Default = false,
})

-- UI SETTINGS
local MenuGroup = Tabs["UI Settings"]:AddLeftGroupbox("Menu")

MenuGroup:AddLabel("Menu Keybind"):AddKeyPicker("MenuKeybind", {
    Default = "RightShift",
    NoUI = true,
    Text = "Menu Toggle"
})

Library.ToggleKeybind = Options.MenuKeybind

Library:OnUnload(function()
    Module.Cleanup()
end)

ThemeManager:SetLibrary(Library)
SaveManager:SetLibrary(Library)
SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({"MenuKeybind"})
ThemeManager:SetFolder("CombatAssistant")
SaveManager:SetFolder("CombatAssistant/configs")
SaveManager:BuildConfigSection(Tabs["UI Settings"])
ThemeManager:ApplyToTab(Tabs["UI Settings"])